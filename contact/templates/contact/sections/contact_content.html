{% if contact_content %}
<div class="grid grid-cols-1 lg:grid-cols-2 gap-16 items-start">
    <!-- Contact Form (First on Mobile, Second on Desktop) -->
    <div class="bg-white/40 backdrop-blur-xl p-10 lg:p-12 rounded-[3rem] border border-border shadow-2xl lg:order-2">
        <form id="contact-form" onsubmit="submitContactForm(event)" novalidate>
            {% csrf_token %}
        
            <!-- Honeypot: hidden field that real users never see or fill -->
            <div style="position:absolute;left:-9999px;height:0;overflow:hidden;" aria-hidden="true">
                <label for="website_url">Leave this field empty</label>
                <input type="text" id="website_url" name="website_url" tabindex="-1" autocomplete="off" value="">
            </div>
        
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
                <div class="space-y-2">
                    <label class="text-[10px] font-bold uppercase tracking-widest text-muted-foreground ml-1">First Name</label>
                    <input type="text" name="first_name" required placeholder="John"
                        class="w-full bg-white/50 border border-border rounded-xl px-6 py-4 focus:outline-none focus:border-accent transition-all text-sm">
                </div>
                <div class="space-y-2">
                    <label class="text-[10px] font-bold uppercase tracking-widest text-muted-foreground ml-1">Last Name</label>
                    <input type="text" name="last_name" required placeholder="Doe"
                        class="w-full bg-white/50 border border-border rounded-xl px-6 py-4 focus:outline-none focus:border-accent transition-all text-sm">
                </div>
            </div>

            <div class="space-y-2 mb-8">
                <label class="text-[10px] font-bold uppercase tracking-widest text-muted-foreground ml-1">Email Address</label>
                <input type="email" name="email" required placeholder="john@example.com"
                    class="w-full bg-white/50 border border-border rounded-xl px-6 py-4 focus:outline-none focus:border-accent transition-all text-sm">
            </div>
            
            <div class="space-y-2 mb-8">
                <label class="text-[10px] font-bold uppercase tracking-widest text-muted-foreground ml-1">Subject</label>
                <select name="subject" required
                    class="w-full bg-white/50 border border-border rounded-xl px-6 py-4 focus:outline-none focus:border-accent transition-all text-sm appearance-none">
                    <option value="" disabled selected>Select a topic…</option>
                    {% for choice in contact_content.form.subject_options %}
                    <option value="{{ choice }}">{{ choice }}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="space-y-2 mb-8">
                <label class="text-[10px] font-bold uppercase tracking-widest text-muted-foreground ml-1">Your Message</label>
                <textarea name="message" rows="6" required placeholder="Tell us about your project…"
                    class="w-full bg-white/50 border border-border rounded-xl px-6 py-4 focus:outline-none focus:border-accent transition-all text-sm"></textarea>
            </div>

            <button type="submit" id="contact-submit-btn"
                class="w-full bg-accent text-white rounded-xl px-8 py-5 font-bold text-sm tracking-[0.2em] uppercase hover:bg-texts hover:shadow-2xl transition-all duration-300 transform active:scale-[0.98] disabled:opacity-50 disabled:cursor-not-allowed">
                Send Message
            </button>
<div id="contact-success" class="hidden mt-6 p-4 bg-green-50 border border-green-200 rounded-xl">
    <p class="text-green-700 text-center font-medium"></p>
</div>
<div id="contact-error" class="hidden mt-6 p-4 bg-red-50 border border-red-200 rounded-xl">
    <p class="text-red-700 text-center"></p>
</div>
        </form>
<script>
    async function submitContactForm(e) {
        e.preventDefault();
        const form = document.getElementById('contact-form');
        const btn = document.getElementById('contact-submit-btn');
        const successEl = document.getElementById('contact-success');
        const errorEl = document.getElementById('contact-error');

        successEl.classList.add('hidden');
        errorEl.classList.add('hidden');
        btn.disabled = true;
        btn.textContent = 'Sending…';

        try {
            const resp = await fetch("{% url 'contact_submit' %}", {
                method: 'POST',
                body: new FormData(form),
                headers: { 'X-CSRFToken': form.querySelector('[name=csrfmiddlewaretoken]').value }
            });

            const data = await resp.json();

            if (data.success) {
                successEl.querySelector('p').textContent = data.message;
                successEl.classList.remove('hidden');
                form.reset();
            } else {
                const msgs = data.errors
                    ? Object.values(data.errors).flat().join(' ')
                    : data.message;
                errorEl.querySelector('p').textContent = msgs || 'Something went wrong.';
                errorEl.classList.remove('hidden');
            }
        } catch (err) {
            errorEl.querySelector('p').textContent = 'Network error. Please try again.';
            errorEl.classList.remove('hidden');
        } finally {
            btn.disabled = false;
            btn.textContent = 'Send Message';
        }
    }
</script>
    </div>

    <!-- Contact Information (Second on Mobile, First on Desktop) -->
    <div class="space-y-12 lg:order-1">
        <div>
            <h3 class="text-2xl font-serif font-bold text-foreground mb-8">Contact Information</h3>
            <div class="space-y-8">
                <div class="flex items-start space-x-6 group">
                    <div
                        class="w-12 h-12 rounded-2xl bg-white shadow-lg flex items-center justify-center text-accent group-hover:bg-accent group-hover:text-white transition-all duration-300">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                            class="lucide lucide-phone w-5 h-5">
                            <path
                                d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z">
                            </path>
                        </svg>
                    </div>
                    <div>
                        <p class="text-[10px] font-bold uppercase tracking-widest text-muted-foreground mb-1">Call Us</p>
                        <p class="text-lg font-bold text-foreground">{{ company.primary_phone|default:"+254 712 345 678" }}</p>
                    </div>
                </div>
                
                <div class="flex items-start space-x-6 group">
                    <div
                        class="w-12 h-12 rounded-2xl bg-white shadow-lg flex items-center justify-center text-accent group-hover:bg-accent group-hover:text-white transition-all duration-300">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                            class="lucide lucide-mail w-5 h-5">
                            <rect width="20" height="16" x="2" y="4" rx="2"></rect>
                            <path d="m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7"></path>
                        </svg>
                    </div>
                    <div>
                        <p class="text-[10px] font-bold uppercase tracking-widest text-muted-foreground mb-1">Email Us</p>
                        <p class="text-lg font-bold text-foreground">{{ company.primary_email|default:"info@anchorfields.co.ke" }}</p>
                    </div>
                </div>
                <div class="flex items-start space-x-6 group">
                    <div class="w-12 h-12 rounded-2xl bg-white shadow-lg flex items-center justify-center text-accent group-hover:bg-accent group-hover:text-white transition-all duration-300">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-map-pin w-5 h-5">
                            <path d="M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0">
                            </path>
                            <circle cx="12" cy="10" r="3"></circle>
                        </svg>
                    </div>
                    <div>
                        <p class="text-[10px] font-bold uppercase tracking-widest text-muted-foreground mb-1">Visit Us</p>
                        <p class="text-lg font-bold text-foreground">{{ company.physical_address|default:"" }}{% if company.city %}<br />{{
                            company.city }}, {{ company.country }}{% endif %}</p>
                    </div>
                </div>
                
            </div>
        </div>

        {% if contact_content.info.map %}
        <div class="p-8 bg-white/40 backdrop-blur-xl rounded-3xl border border-border shadow-xl overflow-hidden relative min-h-75">
            {% if company and company.osm_embed_url %}
                <iframe
                    src="{{ company.osm_embed_url }}"
                    class="absolute inset-0 w-full h-full border-0 grayscale hover:grayscale-0 transition-all duration-300"
                    loading="lazy"
                    title="Office location of {{ company.trading_name }}"
                    sandbox="allow-scripts allow-same-origin">
                </iframe>
                <a href="{{ company.osm_full_url }}" target="_blank" rel="noopener noreferrer"
                   class="absolute inset-0 z-10" title="View larger map"></a>
                <div class="absolute bottom-0 left-0 right-0 bg-black/50 text-white text-[9px] font-bold uppercase tracking-widest text-center py-1 pointer-events-none">
                    {{ company.city }}{% if company.county %}, {{ company.county }}{% endif %}
                </div>
            {% elif contact_content.info.map.image_url %}
                <img src="{{ contact_content.info.map.image_url }}" alt="{{ contact_content.info.map.alt_text }}" class="absolute inset-0 w-full h-full object-cover grayscale opacity-50">
                <div class="relative z-10 h-full flex items-center justify-center">
                    <div class="bg-white/80 backdrop-blur-md px-6 py-3 rounded-full text-xs font-bold uppercase tracking-widest shadow-lg">
                        {{ contact_content.info.map.label }}
                    </div>
                </div>
            {% else %}
                <div class="absolute inset-0 bg-muted/20 animate-pulse"></div>
                <div class="relative z-10 h-full flex items-center justify-center">
                    <div class="bg-white/80 backdrop-blur-md px-6 py-3 rounded-full text-xs font-bold uppercase tracking-widest shadow-lg">
                        {{ contact_content.info.map.label }}
                    </div>
                </div>
            {% endif %}
        </div>
        {% endif %}
    </div>
</div>
{% endif %}