{% extends "_base.html" %}
{% load static %}

{% block title %}
<title>{{ object.location }} | TrustBuild Urban</title>
{% endblock %}

{% block content %}
<!-- Sheet Overlay -->
<div id="sheet-overlay" class="fixed inset-0 bg-black/50 z-50 hidden transition-opacity duration-300" onclick="closeAllSheets()"></div>

<!-- Request Showing Sheet -->
<div id="showing-sheet" class="fixed top-0 right-0 h-full w-full sm:w-2/5 bg-white z-50 transform translate-x-full transition-transform duration-300 ease-out shadow-2xl overflow-y-auto min-w-[400px] max-w-[600px]">
    <div class="p-6">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-2xl font-bold text-texts">Request a Showing</h2>
            <button onclick="closeShowingSheet()" class="p-2 hover:bg-gray-100 rounded-full transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
            </button>
        </div>
        
        <p class="text-gray-600 mb-6">Schedule a property viewing at {{ object.location }}</p>
        
        <form id="showing-form" onsubmit="submitShowingForm(event)">
            {% csrf_token %}
            <input type="hidden" name="property_id" value="{{ object.id }}">
            
            <div class="space-y-4">
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">First Name *</label>
                        <input type="text" name="first_name" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-transparent transition-all placeholder:text-gray-400" placeholder="John" class="placeholder:text-gray-400">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Last Name *</label>
                        <input type="text" name="last_name" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-transparent transition-all placeholder:text-gray-400" placeholder="Doe">
                    </div>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Email *</label>
                    <input type="email" name="email" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-transparent transition-all placeholder:text-gray-400" placeholder="john@example.com">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Phone *</label>
                    <input type="tel" name="phone" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-transparent transition-all placeholder:text-gray-400" placeholder="+254 700 000000">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Preferred Date *</label>
                    <input type="date" name="preferred_date" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-transparent transition-all placeholder:text-gray-400">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Preferred Time</label>
                    <select name="preferred_time" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-transparent transition-all placeholder:text-gray-400">
                        <option value="any">Any Time</option>
                        <option value="morning">Morning (9AM - 12PM)</option>
                        <option value="afternoon">Afternoon (12PM - 4PM)</option>
                        <option value="evening">Evening (4PM - 6PM)</option>
                    </select>
                </div>
                
                <div class="flex items-center gap-2">
                    <input type="checkbox" name="is_first_time_buyer" id="showing_first_time" class="w-4 h-4 text-accent rounded border-gray-300 focus:ring-accent">
                    <label for="showing_first_time" class="text-sm text-gray-600">This is my first home purchase</label>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Message (Optional)</label>
                    <textarea name="message" rows="3" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-transparent transition-all placeholder:text-gray-400" placeholder="Any questions or special requests?"></textarea>
                </div>
            </div>
            
            <button type="submit" class="w-full mt-6 py-4 bg-[#E63946] text-white font-bold uppercase tracking-[0.2em] text-xs rounded-xl shadow-md hover:shadow-lg hover:-translate-y-0.5 transition-all disabled:opacity-50 disabled:cursor-not-allowed" id="showing-submit-btn">
                Submit Request
            </button>
            
            <div id="showing-success" class="hidden mt-4 p-4 bg-green-50 border border-green-200 rounded-lg">
                <p class="text-green-700 text-center font-medium"></p>
            </div>
            
            <div id="showing-error" class="hidden mt-4 p-4 bg-red-50 border border-red-200 rounded-lg">
                <p class="text-red-700 text-center"></p>
            </div>
        </form>
    </div>
</div>

<!-- Start Offer Sheet -->
<div id="offer-sheet" class="fixed top-0 right-0 h-full w-full sm:w-2/5 bg-white z-50 transform translate-x-full transition-transform duration-300 ease-out shadow-2xl overflow-y-auto min-w-[400px] max-w-[600px]">
    <div class="p-6">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-2xl font-bold text-texts">Make an Offer</h2>
            <button onclick="closeOfferSheet()" class="p-2 hover:bg-gray-100 rounded-full transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
            </button>
        </div>
        
        <p class="text-gray-600 mb-6">Submit an offer for {{ object.location }}</p>
        
        <form id="offer-form" onsubmit="submitOfferForm(event)">
            {% csrf_token %}
            <input type="hidden" name="property_id" value="{{ object.id }}">
            
            <div class="space-y-4">
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">First Name *</label>
                        <input type="text" name="first_name" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-transparent transition-all placeholder:text-gray-400" placeholder="John" class="placeholder:text-gray-400">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Last Name *</label>
                        <input type="text" name="last_name" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-transparent transition-all placeholder:text-gray-400" placeholder="Doe">
                    </div>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Email *</label>
                    <input type="email" name="email" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-transparent transition-all placeholder:text-gray-400" placeholder="john@example.com">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Phone *</label>
                    <input type="tel" name="phone" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-transparent transition-all placeholder:text-gray-400" placeholder="+254 700 000000">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Offer Amount (KES) *</label>
                    <input type="text" name="offer_amount" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-transparent transition-all placeholder:text-gray-400" placeholder="e.g., KES 25,000,000">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Financing Type</label>
                    <select name="financing_type" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-transparent transition-all placeholder:text-gray-400">
                        <option value="mortgage">Mortgage</option>
                        <option value="cash">Cash</option>
                        <option value="exchange">Property Exchange</option>
                        <option value="installment">Installment</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                
                <div class="flex items-center gap-2">
                    <input type="checkbox" name="is_first_time_buyer" id="offer_first_time" class="w-4 h-4 text-accent rounded border-gray-300 focus:ring-accent">
                    <label for="offer_first_time" class="text-sm text-gray-600">This is my first home purchase</label>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Additional Terms / Message</label>
                    <textarea name="message" rows="3" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-transparent transition-all placeholder:text-gray-400" placeholder="Any additional terms or questions?"></textarea>
                </div>
            </div>
            
            <button type="submit" class="w-full mt-6 py-4 bg-[#E63946] text-white font-bold uppercase tracking-[0.2em] text-xs rounded-xl shadow-md hover:shadow-lg hover:-translate-y-0.5 transition-all disabled:opacity-50 disabled:cursor-not-allowed" id="offer-submit-btn">
                Submit Offer
            </button>
            
            <div id="offer-success" class="hidden mt-4 p-4 bg-green-50 border border-green-200 rounded-lg">
                <p class="text-green-700 text-center font-medium"></p>
            </div>
            
            <div id="offer-error" class="hidden mt-4 p-4 bg-red-50 border border-red-200 rounded-lg">
                <p class="text-red-700 text-center"></p>
            </div>
        </form>
    </div>
</div>

<script>
// Sheet Functions
function openShowingSheet() {
    document.getElementById('sheet-overlay').classList.remove('hidden');
    document.getElementById('showing-sheet').classList.remove('translate-x-full');
    document.body.style.overflow = 'hidden';
}

function closeShowingSheet() {
    document.getElementById('sheet-overlay').classList.add('hidden');
    document.getElementById('showing-sheet').classList.add('translate-x-full');
    document.body.style.overflow = '';
    resetShowingForm();
}

function openOfferSheet() {
    document.getElementById('sheet-overlay').classList.remove('hidden');
    document.getElementById('offer-sheet').classList.remove('translate-x-full');
    document.body.style.overflow = 'hidden';
}

function closeOfferSheet() {
    document.getElementById('sheet-overlay').classList.add('hidden');
    document.getElementById('offer-sheet').classList.add('translate-x-full');
    document.body.style.overflow = '';
    resetOfferForm();
}

function closeAllSheets() {
    closeShowingSheet();
    closeOfferSheet();
}

function resetShowingForm() {
    document.getElementById('showing-form').reset();
    document.getElementById('showing-success').classList.add('hidden');
    document.getElementById('showing-error').classList.add('hidden');
}

function resetOfferForm() {
    document.getElementById('offer-form').reset();
    document.getElementById('offer-success').classList.add('hidden');
    document.getElementById('offer-error').classList.add('hidden');
}

// Form Submissions
async function submitShowingForm(event) {
    event.preventDefault();
    
    const submitBtn = document.getElementById('showing-submit-btn');
    const successDiv = document.getElementById('showing-success');
    const errorDiv = document.getElementById('showing-error');
    
    submitBtn.disabled = true;
    submitBtn.textContent = 'Submitting...';
    
    const formData = new FormData(event.target);
    
    try {
        const response = await fetch('/available-homes/api/submit-showing/', {
            method: 'POST',
            body: formData,
            headers: {
                'X-Requested-With': 'XMLHttpRequest',
            }
        });
        
        const data = await response.json();
        
        if (data.success) {
            successDiv.querySelector('p').textContent = data.message;
            successDiv.classList.remove('hidden');
            errorDiv.classList.add('hidden');
            setTimeout(() => {
                closeShowingSheet();
            }, 2000);
        } else {
            errorDiv.querySelector('p').textContent = data.message;
            errorDiv.classList.remove('hidden');
            successDiv.classList.add('hidden');
        }
    } catch (error) {
        errorDiv.querySelector('p').textContent = 'An error occurred. Please try again.';
        errorDiv.classList.remove('hidden');
        successDiv.classList.add('hidden');
    } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = 'Submit Request';
    }
}

async function submitOfferForm(event) {
    event.preventDefault();
    
    const submitBtn = document.getElementById('offer-submit-btn');
    const successDiv = document.getElementById('offer-success');
    const errorDiv = document.getElementById('offer-error');
    
    submitBtn.disabled = true;
    submitBtn.textContent = 'Submitting...';
    
    const formData = new FormData(event.target);
    
    try {
        const response = await fetch('/available-homes/api/submit-offer/', {
            method: 'POST',
            body: formData,
            headers: {
                'X-Requested-With': 'XMLHttpRequest',
            }
        });
        
        const data = await response.json();
        
        if (data.success) {
            successDiv.querySelector('p').textContent = data.message;
            successDiv.classList.remove('hidden');
            errorDiv.classList.add('hidden');
            setTimeout(() => {
                closeOfferSheet();
            }, 2000);
        } else {
            errorDiv.querySelector('p').textContent = data.message;
            errorDiv.classList.remove('hidden');
            successDiv.classList.add('hidden');
        }
    } catch (error) {
        errorDiv.querySelector('p').textContent = 'An error occurred. Please try again.';
        errorDiv.classList.remove('hidden');
        successDiv.classList.add('hidden');
    } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = 'Submit Offer';
    }
}

// Escape key to close sheets
document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
        closeAllSheets();
    }
});
</script>

<div class="bg-white font-sans text-texts pt-24 lg:pt-28">
    <!-- Sticky Sub-Nav (Desktop Only) -->
    <nav class=" top-[76px] lg:top-[84px] z-40 bg-white border-b border-gray-200 hidden lg:block">
        <div class="max-w-7xl mx-auto px-6 flex items-center space-x-8 h-14 text-[11px] font-bold uppercase tracking-widest text-texts/60">
            <a href="#overview" class="text-texts border-b-2 border-texts h-full flex items-center">Overview</a>
            <a href="#about" class="hover:text-texts transition-colors h-full flex items-center">About This Home</a>
            <a href="#details" class="hover:text-texts transition-colors h-full flex items-center">Property Details</a>
            <a href="#neighborhood" class="hover:text-texts transition-colors h-full flex items-center">Neighborhood</a>
        </div>
    </nav>

    <!-- Main Content Container -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 py-4">

        <!-- Carousel with Sidebar Gallery -->
        <div class="w-full mb-8 flex gap-1" style="height: auto; min-height: 400px; max-height: 600px;">
            <!-- Main Carousel (Left) -->
            <div id="controls-carousel" class="relative flex-1" data-carousel="static">
                <!-- Carousel wrapper -->
                <div class="relative h-full overflow-hidden rounded-l-xl">
                    {% if object.cover %}
                    <div class="hidden duration-700 ease-in-out" data-carousel-item>
                        <img src="{{ object.cover.get_image_url }}" class="absolute block w-full h-full object-cover" alt="{{ object.title }}">
                    </div>
                    {% endif %}
                    {% for img in object.images.all %}
                    <div class="hidden duration-700 ease-in-out" data-carousel-item>
                        <img src="{{ img.get_image_url }}" class="absolute block w-full h-full object-cover" alt="{{ object.title }}">
                    </div>
                    {% endfor %}
                </div>
                <!-- Slider controls -->
                <button type="button" class="absolute top-0 start-0 z-30 flex items-center justify-center h-full px-4 cursor-pointer group focus:outline-none" data-carousel-prev>
                    <span class="inline-flex items-center justify-center w-10 h-10 rounded-full bg-white/80 group-hover:bg-white/90">
                        <svg class="w-5 h-5 text-gray-800" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/></svg>
                        <span class="sr-only">Previous</span>
                    </span>
                </button>
                <button type="button" class="absolute top-0 end-0 z-30 flex items-center justify-center h-full px-4 cursor-pointer group focus:outline-none" data-carousel-next>
                    <span class="inline-flex items-center justify-center w-10 h-10 rounded-full bg-white/80 group-hover:bg-white/90">
                        <svg class="w-5 h-5 text-gray-800" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg>
                        <span class="sr-only">Next</span>
                    </span>
                </button>
            </div>

            <!-- Sidebar Gallery (Right - all additional images) -->
            <div class="hidden md:grid w-48 flex-shrink-0 grid grid-rows-3 gap-1 h-full overflow-y-auto bg-gray-50 rounded-r-xl">
                {% for img in object.images.all %}
                <div class="relative overflow-hidden cursor-pointer group thumbnail-slot">
                    <img src="{{ img.get_image_url }}" class="w-full h-full object-cover" alt="{{ object.title }}">
                    <div class="absolute inset-0 bg-black/20 opacity-0 group-hover:opacity-100 transition-opacity"></div>
                </div>
                {% empty %}
                <div class="flex items-center justify-center text-gray-400 text-xs p-2 text-center col-span-3">No additional images</div>
                {% endfor %}
            </div>
        </div>

        <div class="flex flex-col lg:flex-row gap-12">
            <!-- Left Column: Content -->
            <div class="lg:w-[70%]">
                <!-- Header Info (Exact Redfin Re-alignment) -->
                <div id="overview" class="mb-10 pb-10 border-b border-gray-100 flex flex-col md:flex-row justify-between gap-8">
                    <div class="flex-grow">
                        <div class="flex items-center space-x-2 text-green-700 font-bold text-[10px] uppercase tracking-widest mb-4 bg-green-50 w-fit px-3 py-1 rounded-full">
                            <span class="w-2 h-2 rounded-full bg-green-600 animate-pulse"></span>
                            <span>{{ object.get_status_display_custom|upper }}</span>
                        </div>
                        
                        <div class="flex items-baseline space-x-4 mb-4">
                            <h1 class="text-4xl md:text-5xl font-black text-texts tracking-tight leading-none">{{ object.price }}</h1>
                        </div>

                        <div class="flex items-center space-x-6 mb-6">
                            <div class="flex items-baseline space-x-1">
                                <span class="text-3xl font-bold">{{ object.beds|default:"—" }}</span>
                                <span class="text-[11px] font-bold uppercase tracking-wider text-gray-500">bd</span>
                            </div>
                            <div class="w-px h-8 bg-gray-200"></div>
                            <div class="flex items-baseline space-x-1">
                                <span class="text-3xl font-bold">{{ object.baths|default:"—" }}</span>
                                <span class="text-[11px] font-bold uppercase tracking-wider text-gray-500">ba</span>
                            </div>
                            <div class="w-px h-8 bg-gray-200"></div>
                            <div class="flex items-baseline space-x-1">
                                <span class="text-3xl font-bold">{{ object.sqft|default:"—" }}</span>
                                <span class="text-[11px] font-bold uppercase tracking-wider text-gray-500">sq ft</span>
                            </div>
                        </div>

                        <div class="text-xl md:text-2xl font-bold text-texts/80">
                            {{ object.location }}
                        </div>
                    </div>

                    <!-- Mini Map Box Placeholder -->
                    <div class="hidden md:block w-56 h-36 rounded-2xl overflow-hidden border border-gray-200 relative group cursor-pointer shadow-sm">
                        <img src="https://images.unsplash.com/photo-1524661135-423995f22d0b?auto=format&fit=crop&w=400&q=80" class="w-full h-full object-cover grayscale opacity-60 group-hover:grayscale-0 group-hover:opacity-100 transition-all">
                        <div class="absolute inset-0 flex items-center justify-center">
                            <div class="w-8 h-8 bg-accent rounded-full border-4 border-white shadow-xl animate-bounce"></div>
                        </div>
                    </div>
                </div>

                <!-- Mobile CTA (Visible on small screens only) -->
                <div class="lg:hidden mb-8">
                    <div class="p-6 border border-gray-100 rounded-2xl shadow-lg bg-white">
                        <button onclick="openShowingSheet()" class="w-full py-4 bg-[#E63946] text-white font-bold uppercase tracking-[0.2em] text-xs rounded-xl shadow-md mb-3">
                            Request showing
                        </button>
                        <button onclick="openOfferSheet()" class="w-full py-4 border-2 border-texts text-texts font-bold uppercase tracking-[0.2em] text-xs rounded-xl">
                            Start an offer
                        </button>
                    </div>
                </div>

                <!-- About section -->
                <section id="about" class="mb-12">
                    <h2 class="text-2xl font-serif font-black text-texts mb-8">About This Home</h2>
                    {% if object.description %}
                    <div class="prose prose-gray max-w-none text-texts/70 leading-relaxed mb-10 text-lg">
                        {{ object.description|linebreaks }}
                    </div>
                    {% endif %}
                    
                    <!-- Summary Highlights -->
                    {% if bedroom_info or bathroom_info or garage_and_parking_info %}
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12">
                        {% if bedroom_info %}
                        <div class="p-8 bg-gray-50/50 rounded-2xl border border-gray-100 flex flex-col items-center text-center space-y-4">
                            <div class="p-4 bg-white rounded-xl shadow-sm text-accent">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 20h20"/><path d="M7 20V8a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v12"/><path d="M7 12V4a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v8"/></svg>
                            </div>
                            <div>
                                <div class="font-bold text-lg text-texts leading-tight">{{ object.beds }} Bedrooms</div>
                                <div class="text-[10px] font-bold uppercase tracking-widest text-gray-400 mt-1">Bedrooms</div>
                            </div>
                        </div>
                        {% endif %}
                        {% if bathroom_info %}
                        <div class="p-8 bg-gray-50/50 rounded-2xl border border-gray-100 flex flex-col items-center text-center space-y-4">
                            <div class="p-4 bg-white rounded-xl shadow-sm text-accent">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/></svg>
                            </div>
                            <div>
                                <div class="font-bold text-lg text-texts leading-tight">{{ object.baths }} Bathrooms</div>
                                <div class="text-[10px] font-bold uppercase tracking-widest text-gray-400 mt-1">Bathrooms</div>
                            </div>
                        </div>
                        {% endif %}
                        {% if garage_and_parking_info %}
                        <div class="p-8 bg-gray-50/50 rounded-2xl border border-gray-100 flex flex-col items-center text-center space-y-4">
                            <div class="p-4 bg-white rounded-xl shadow-sm text-accent">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="1" y="3" width="22" height="18" rx="2" ry="2"/><line x1="1" y1="9" x2="23" y2="9"/></svg>
                            </div>
                            <div>
                                <div class="font-bold text-lg text-texts leading-tight">{% for item in garage_and_parking_info %}{% if forloop.first %}{{ item.value }}{% endif %}{% endfor %}</div>
                                <div class="text-[10px] font-bold uppercase tracking-widest text-gray-400 mt-1">Parking</div>
                            </div>
                        </div>
                        {% endif %}
                    </div>
                    {% endif %}
                </section>

                <!-- Property Details Section -->
                <section id="details" class="mb-12 pt-12 border-t border-gray-100">
                    <h2 class="text-2xl font-serif font-black text-texts mb-10 text-center md:text-left">Detailed Property Information</h2>
                    
                    <div class="space-y-8">
                        <!-- Interior Section -->
                        {% if bedroom_info or bathroom_info or kitchen_and_dining_info or interior_features_info %}
                        <div class="bg-white border border-gray-100 rounded-3xl p-6 md:p-8 shadow-sm">
                            <h3 class="text-xs font-black uppercase tracking-widest text-accent mb-8 flex items-center flex-wrap gap-y-4">
                                <span>Interior Highlights</span>
                                <span class="bg-gray-100 h-px flex-grow ml-0 md:ml-6 w-full md:w-auto"></span>
                            </h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 md:gap-10">
                                {% include 'available_homes/details_parts/bedroom_information.html' %}
                                {% include 'available_homes/details_parts/bathroom_information.html' %}
                                {% include 'available_homes/details_parts/kitchen_and_dining.html' %}
                                {% include 'available_homes/details_parts/interior_features.html' %}
                            </div>
                        </div>
                        {% endif %}

                        <!-- Heating & Cooling -->
                        {% if heating_and_cooling_info %}
                        <div class="bg-white border border-gray-100 rounded-3xl p-6 md:p-8 shadow-sm">
                            <h3 class="text-xs font-black uppercase tracking-widest text-accent mb-8 flex items-center flex-wrap gap-y-4">
                                <span>Climate Control</span>
                                <span class="bg-gray-100 h-px flex-grow ml-0 md:ml-6 w-full md:w-auto"></span>
                            </h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 md:gap-10">
                                {% include 'available_homes/details_parts/heating_and_cooling.html' %}
                            </div>
                        </div>
                        {% endif %}

                        <!-- Other Rooms -->
                        {% if other_rooms_info %}
                        <div class="bg-white border border-gray-100 rounded-3xl p-6 md:p-8 shadow-sm">
                            <h3 class="text-xs font-black uppercase tracking-widest text-accent mb-8 flex items-center flex-wrap gap-y-4">
                                <span>Additional Spaces</span>
                                <span class="bg-gray-100 h-px flex-grow ml-0 md:ml-6 w-full md:w-auto"></span>
                            </h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 md:gap-10">
                                {% include 'available_homes/details_parts/other_rooms.html' %}
                            </div>
                        </div>
                        {% endif %}

                        <!-- Parking & Exterior -->
                        {% if garage_and_parking_info or outdoor_spaces_info %}
                        <div class="bg-white border border-gray-100 rounded-3xl p-6 md:p-8 shadow-sm">
                            <h3 class="text-xs font-black uppercase tracking-widest text-accent mb-8 flex items-center flex-wrap gap-y-4">
                                <span>Parking & Exterior</span>
                                <span class="bg-gray-100 h-px flex-grow ml-0 md:ml-6 w-full md:w-auto"></span>
                            </h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 md:gap-10">
                                {% include 'available_homes/details_parts/garage_and_parking.html' %}
                                {% include 'available_homes/details_parts/outdoor_spaces.html' %}
                            </div>
                        </div>
                        {% endif %}

                        <!-- Utilities & Green Energy -->
                        {% if utilities_and_green_energy_info %}
                        <div class="bg-white border border-gray-100 rounded-3xl p-6 md:p-8 shadow-sm">
                            <h3 class="text-xs font-black uppercase tracking-widest text-accent mb-8 flex items-center flex-wrap gap-y-4">
                                <span>Utilities & Green Energy</span>
                                <span class="bg-gray-100 h-px flex-grow ml-0 md:ml-6 w-full md:w-auto"></span>
                            </h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 md:gap-10">
                                {% include 'available_homes/details_parts/utilities_and_green_energy.html' %}
                            </div>
                        </div>
                        {% endif %}
                    </div>
                </section>
            </div>

            <!-- Right Column: Sidebar (Sticky Sidebar Enhanced) -->
            <div class="hidden lg:block lg:w-[30%]">
                <div class="sticky top-28 lg:top-40 space-y-8">
                    <!-- Action Card -->
                    <div class="p-8 border border-gray-100 rounded-[2.5rem] shadow-2xl bg-white relative overflow-hidden group">
                        <div class="absolute top-0 right-0 w-32 h-32 bg-accent/5 rounded-full -mr-16 -mt-16 blur-2xl transition-all group-hover:bg-accent/10"></div>
                        
                        <button onclick="openShowingSheet()" class="w-full py-6 bg-[#E63946] text-white font-bold uppercase tracking-[0.2em] text-xs rounded-2xl shadow-xl hover:shadow-red-200 hover:-translate-y-1 transition-all mb-4 relative z-10">
                            Request showing
                        </button>
                        <button onclick="openOfferSheet()" class="w-full py-6 border-2 border-texts text-texts font-bold uppercase tracking-[0.2em] text-xs rounded-2xl hover:bg-gray-50 hover:-translate-y-1 transition-all mb-10 relative z-10">
                            Start an offer
                        </button>
                        
                        <div class="pt-8 border-t border-gray-100 flex flex-col items-center space-y-4 relative z-10">
                           <a href="/contact" class="text-[11px] font-bold text-accent uppercase tracking-widest hover:text-secondary transition-colors">Ask a question</a>
                           <div class="h-1 w-1 rounded-full bg-gray-200"></div>
                           <a href="tel:7085782846" class="text-lg font-black text-texts tracking-tighter">(708) 578-2846</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
</div>
{% endblock %}

